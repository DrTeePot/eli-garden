<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Tristan's Garden</title>
    <!-- <link rel="stylesheet" href="style.css"> -->
    <style type="text/css">
      @import url("https://cdn.jsdelivr.net/npm/@xz/fonts@1/serve/anonymous-pro.min.css");

      body {
        font-family: 'Anonymous Pro', sans-serif;
        padding: 30px 50px;
        background-color: #fdfdfe;
        max-width: 650px;
        margin: 0 auto;
      }
      ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
      }
      li {
        margin: 0;
      }
      h3 {
        padding: 0px 0px;
        margin: 5px 0px;

      }
    </style>
    <script src="papaparse.min.js"></script>
    <script src="markdown-it.min.js"></script>

  </head>
  <body>
    <header>
      <h1>
        Garden of Thoughts
      </h1>
      <nav>
        <a href="">Blog</a> | <a href="">Projects</a> | <a href="">About</a> | <a href="">Resume</a>
      </nav>
      <hr>
    </header>

    <main>
      <!-- <h2>  </h2> -->

      <ul id="thoughts">
        <li>
          <h3> Timestamp 1 </h3>
          <div><p>some text</p> </div>
        </li>
      </ul>
    </main>

    <script>
      function main() {
        const url = getThoughtURL();
        var container = document.getElementById('thoughts');

        const csv = 'timestamp,body\nj
          6/11/2020 22:29:14,"\
          With some text\n\
          *bold* _underlined_ ~~strike~~ :smile:"';


        parse_csv_url(url, parse_row(container));
      }

      function parse_row(container) {
        return function (row) {
          var md = window.markdownit({
             breaks: true,
             typographer: true,
          });
          const timestamp = row.data["timestamp"];
          const thought = row.data["body"];
          const thought_html = `<h3> ${ timestamp } </h3> <li>${md.render(thought)}</li>`;
          appendThought(container, thought_html);
        }
      }

      function parse_csv_url(url, step_func) {
        Papa.parse(url, {
          download: true,
          worker: true,
          header: true,
          step: step_func,
          complete: function() {
            console.log("All done!");
          },
          error: function(error) {
            console.log(error);
          },
        });
      }

      function parse_csv_string(csv, step_func) {
        Papa.parse(csv, {
          header: true,
          step: step_func,
          complete: function() {
            console.log("All done!");
          },
          error: function(error) {
            console.log(error);
          },
        });
      }

      function appendThought(container, html) {
        var div = document.createElement('li');
        div.innerHTML += html;
        container.insertBefore(div, null);
      }

      function getThoughtURL() {
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vSf2Kwv4OA-Pd5q3a6pdQkvBA9i0iDpD-fA6BFrX1dzH5VIGXK_XCPU9GW2p8HPyaOwU6QA155ezHkl/pub?gid=0&single=true&output=csv";
      }

      main();
    </script>
  </body>
</html>
